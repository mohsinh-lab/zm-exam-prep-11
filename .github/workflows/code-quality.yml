name: Code Quality

on:
  push:
    branches: ["main", "develop"]
  pull_request:
    branches: ["main"]
  workflow_dispatch:

jobs:
  lint:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        
      - name: Set up Node
        uses: actions/setup-node@v6
        with:
          node-version: 20
          cache: 'npm'
          cache-dependency-path: './Test App/package-lock.json'
          
      - name: Install dependencies
        working-directory: './Test App'
        run: npm ci
        
      - name: Check for console.log statements
        working-directory: './Test App'
        run: |
          if grep -r "console\.log" src/ --exclude-dir=node_modules; then
            echo "⚠️ Found console.log statements in source code"
            exit 1
          else
            echo "✅ No console.log statements found"
          fi
        continue-on-error: true
        
      - name: Check for TODO comments
        working-directory: './Test App'
        run: |
          echo "## TODO Comments Found:" >> $GITHUB_STEP_SUMMARY
          grep -rn "TODO\|FIXME\|HACK" src/ --exclude-dir=node_modules || echo "None" >> $GITHUB_STEP_SUMMARY
        continue-on-error: true
        
      - name: Check file sizes
        working-directory: './Test App'
        run: |
          echo "## Large Files (>50KB):" >> $GITHUB_STEP_SUMMARY
          find src/ -type f -size +50k -exec ls -lh {} \; || echo "None" >> $GITHUB_STEP_SUMMARY
        continue-on-error: true

  security:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        
      - name: Set up Node
        uses: actions/setup-node@v6
        with:
          node-version: 20
          
      - name: Run npm audit
        working-directory: './Test App'
        run: npm audit --audit-level=moderate
        continue-on-error: true
        
      - name: Check for secrets
        uses: trufflesecurity/trufflehog@main
        with:
          path: ./
          base: ${{ github.event.repository.default_branch }}
          head: HEAD
